name: Plugins - Trufflehog secrets scanning
description: Scans plugin zip files for secrets using Trufflehog.

inputs:
  trufflehog-version:
    description: |
      Version of Trufflehog to install (e.g.: 3.88.1).
    required: true
  folder:
    description: |
      Folder containing plugin zip files to scan.
      It will be scanned recursively.
    required: true

runs:
  using: composite
  steps:
    - name: Install Trufflehog
      shell: bash
      run: |
        curl -sSfL https://raw.githubusercontent.com/trufflesecurity/trufflehog/v${{ inputs.trufflehog-version }}/scripts/install.sh | sh

    - name: Run Trufflehog
      shell: bash
      run: ./bin/trufflehog filesystem "${{ inputs.folder }}" --no-update --fail --github-actions
