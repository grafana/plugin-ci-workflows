name: Checkout versioned plugin-ci-workflows repository

inputs:
  path:
    description: Path to checkout the versioned plugin-ci-workflows repository
    required: false
    default: _plugin-ci-workflows

runs:
  using: composite
  steps:
    - name: Checkout versioned plugin-ci-workflows
      uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      env:
        action_repo: ${{ github.action_repository }}
        action_ref: ${{ github.action_ref }}
      with:
        repository: ${{ env.action_repo }}
        ref: ${{ env.action_ref }}
        path: ${{ inputs.path }}
        persist-credentials: false

  post:
    - name: Cleanup versioned plugin-ci-workflows
      run: |
        # Check that the directory looks OK before removing it
        if ! [ -d "${PLUGIN_CI_WORKFLOWS_PATH}/.git" ]; then
          echo "::warning Not removing plugin-ci-workflows directory: doesn't look like a git repository"
          exit 0
        fi
        rm -rf "${PLUGIN_CI_WORKFLOWS_PATH}"
      env:
        PLUGIN_CI_WORKFLOWS_PATH: ${{ inputs.path }}
      shell: bash
