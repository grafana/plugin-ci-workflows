name: Plugins - Frontend - Test and build
description: Tests, lints, typechecks and builds the frontend.

inputs:
  working-directory:
    description: Working directory for the action
    required: false
    default: .

runs:
  using: composite
  steps:
    - name: Install dependencies
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ github.action_path }}/pm.sh install

    - name: Lint
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ github.action_path }}/pm.sh lint

    - name: Typecheck
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ github.action_path }}/pm.sh typecheck

    - name: Test
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ github.action_path }}/pm.sh test:ci

    - name: Build
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: ${{ github.action_path }}/pm.sh build

    # The action should end up with a dist/ folder, but if the working directory is not the root of the repo,
    # we need to copy the dist/ folder to the root of the repo.
    - name: Copy dist if needed
      run: |
        if [ "${{ inputs.working-directory }}" != "." ]; then
          mkdir -p dist
          cp -r ${{ inputs.working-directory }}/dist/* dist/
        fi
      shell: bash
      if: inputs.working-directory != '.'
