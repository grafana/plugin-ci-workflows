name: Plugins - Frontend - Test and build
description: Tests, lints, typechecks and builds the frontend.

runs:
  using: composite
  steps:
    - name: Set up cache key
      id: cache-key
      shell: bash
      run: echo "key=node-modules-${{ hashFiles('**/package-lock.json', '**/yarn.lock') }}" >> $GITHUB_OUTPUT

    - name: Cache node_modules
      uses: actions/cache@v4
      with:
        path: |
          **/node_modules
          .yarn/cache
          .yarn/unplugged
        key: ${{ steps.cache-key.outputs.key }}
        restore-keys: |
          node-modules-

    - name: Install dependencies
      shell: bash
      run: ${{ github.action_path }}/pm.sh install

    - name: Lint
      shell: bash
      run: ${{ github.action_path }}/pm.sh lint

    - name: Typecheck
      shell: bash
      run: ${{ github.action_path }}/pm.sh typecheck

    - name: Test
      shell: bash
      run: ${{ github.action_path }}/pm.sh test:ci

    - name: Build
      shell: bash
      run: ${{ github.action_path }}/pm.sh build
