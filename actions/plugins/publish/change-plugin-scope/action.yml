name: Change plugin scope

inputs:
  gcom-token:
    description: GCOM token with permissions to update a plugin version.
    required: true
  gcloud-auth-token:
    description: |
      Google Cloud auth token for IAP access.
      Required only for to dev or ops access.
    required: false
    default: ""
  environment:
    description: |
      Environment where the plugin is published and where the scope will be changed.
      Trying to change the scope in an environment where the plugin is not published will result in an error.
      Can be 'dev', 'ops' (or `staging`), or 'prod'.
    required: true
  scopes:
    description: |
      Scopes to apply to the plugin.
      Can be 'universal', 'grafana_cloud', 'grafana_cloud_org' or 'grafana_cloud_instance'.
      Multiple values can be provided separated by commas.
    required: true
    default: "universal"
  plugin-id:
    description: |
      Plugin ID.
    required: true
  plugin-version:
    description: |
      Plugin version to affect.
    required: true

runs:
  using: composite
  steps:
    - name: Change plugin scope
      run: |
        ${{ github.action_path }}/change-plugin-scope.sh \
          --environment "${ENVIRONMENT}" \
          --scopes "${SCOPES}" \
          "${PLUGIN_ID}" \
          "${PLUGIN_VERSION}"
      env:
        GCLOUD_AUTH_TOKEN: ${{ inputs.gcloud-auth-token }}
        GCOM_TOKEN: ${{ inputs.gcom-token }}

        ENVIRONMENT: ${{ inputs.environment }}
        SCOPES: ${{ inputs.scopes }}
        PLUGIN_ID: ${{ inputs.plugin-id }}
        PLUGIN_VERSION: ${{ inputs.plugin-version }}
      shell: bash
